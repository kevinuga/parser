<?php

class ParserUnitTestCase extends DrupalUnitTestCase {
  public static function getInfo() {
    return array(
      'name' => 'Parser module unit tests',
      'description' => 'Parser module unit tests',
      'group' => 'Parser',
    );
  }

  public function testAbsoluteUrl() {
    module_load_include('inc', 'parser');

    $test_data = array(
      array('http://example.com',          '/',                        'http://example.com/'),
      array('http://example.com',          '?a=b',                     'http://example.com/?a=b'),
      array('http://example.com',          'index.php',                'http://example.com/index.php'),
      array('http://example.com',          'index.php',                'http://example.com/index.php'),
      array('http://example.com',          '/index.php',               'http://example.com/index.php'),
      array('http://example.com',          './index.php',              'http://example.com/index.php'),
      array('http://example.com',          '../index.php',             'http://example.com/index.php'),
      array('http://example.com',          'bar/index.php',            'http://example.com/bar/index.php'),
      array('http://example.com',          '/bar/index.php',           'http://example.com/bar/index.php'),
      array('http://example.com',          '/bar/индекс.php',          'http://example.com/bar/индекс.php'),
      array('http://example.com',          '/bar/index.php?a=b',       'http://example.com/bar/index.php?a=b'),
      array('http://example.com',          '/bar/index.php?a=b b',     'http://example.com/bar/index.php?a=b b'),
      array('http://example.com',          '/bar/индекс.php?a=b b',    'http://example.com/bar/индекс.php?a=b b'),
      array('http://example.com',          '//test.ru/index.php',      'http://test.ru/index.php'),
      array('http://example.com',          'http://test.ru/index.php', 'http://test.ru/index.php'),
      array('http://example.com/',         '/',                        'http://example.com/'),
      array('http://example.com/',         '?a=b',                     'http://example.com/?a=b'),
      array('http://example.com/',         'index.php',                'http://example.com/index.php'),
      array('http://example.com/',         'index.php',                'http://example.com/index.php'),
      array('http://example.com/',         '/index.php',               'http://example.com/index.php'),
      array('http://example.com/',         './index.php',              'http://example.com/index.php'),
      array('http://example.com/',         '../index.php',             'http://example.com/index.php'),
      array('http://example.com/',         'bar/index.php',            'http://example.com/bar/index.php'),
      array('http://example.com/',         '/bar/index.php',           'http://example.com/bar/index.php'),
      array('http://example.com/',         '/bar/index.php?a=b',       'http://example.com/bar/index.php?a=b'),
      array('http://example.com/',         '//test.ru/index.php',      'http://test.ru/index.php'),
      array('http://example.com/',         'http://test.ru/index.php', 'http://test.ru/index.php'),
      array('http://example.com/foo',      '?a=b',                     'http://example.com/foo?a=b'),
      array('http://example.com/foo',      'index.php',                'http://example.com/index.php'),
      array('http://example.com/foo',      '/index.php',               'http://example.com/index.php'),
      array('http://example.com/foo',      './index.php',              'http://example.com/index.php'),
      array('http://example.com/foo',      '../index.php',             'http://example.com/index.php'),
      array('http://example.com/foo',      '../../index.php',          'http://example.com/index.php'),
      array('http://example.com/foo',      'bar/index.php',            'http://example.com/bar/index.php'),
      array('http://example.com/foo',      '/bar/index.php',           'http://example.com/bar/index.php'),
      array('http://example.com/foo',      '/bar/index.php?a=b',       'http://example.com/bar/index.php?a=b'),
      array('http://example.com/foo',      '/бар/index.php?a=b',       'http://example.com/бар/index.php?a=b'),
      array('http://example.com/foo',      '//test.ru/index.php',      'http://test.ru/index.php'),
      array('http://example.com/foo',      'http://test.ru/index.php', 'http://test.ru/index.php'),
      array('http://example.com/foo/',     '?a=b',                     'http://example.com/foo/?a=b'),
      array('http://example.com/foo/',     'index.php',                'http://example.com/foo/index.php'),
      array('http://example.com/foo/',     '/index.php',               'http://example.com/index.php'),
      array('http://example.com/foo/',     './index.php',              'http://example.com/foo/index.php'),
      array('http://example.com/foo/',     '../index.php',             'http://example.com/index.php'),
      array('http://example.com/foo/',     '../../index.php',          'http://example.com/index.php'),
      array('http://example.com/foo/',     'bar/index.php',            'http://example.com/foo/bar/index.php'),
      array('http://example.com/foo/',     '/bar/index.php',           'http://example.com/bar/index.php'),
      array('http://example.com/foo/',     '/bar/index.php?a=b',       'http://example.com/bar/index.php?a=b'),
      array('http://example.com/foo/',     '//test.ru/index.php',      'http://test.ru/index.php'),
      array('http://example.com/foo/',     'http://test.ru/index.php', 'http://test.ru/index.php'),
      array('http://example.com/foo/bar/', '/',                        'http://example.com/'),
      array('http://example.com/foo/bar/', '?a=b',                     'http://example.com/foo/bar/?a=b'),
      array('http://example.com/foo/bar/', 'index.php',                'http://example.com/foo/bar/index.php'),
      array('http://example.com/foo/bar/', '/index.php',               'http://example.com/index.php'),
      array('http://example.com/foo/bar/', './index.php',              'http://example.com/foo/bar/index.php'),
      array('http://example.com/foo/bar/', '../index.php',             'http://example.com/foo/index.php'),
      array('http://example.com/foo/bar/', '../../index.php',          'http://example.com/index.php'),
      array('http://example.com/foo bar/', '/',                        'http://example.com/'),
      array('http://example.com/foo bar/', '?a=b',                     'http://example.com/foo bar/?a=b'),
      array('http://example.com/foo bar/', 'index.php',                'http://example.com/foo bar/index.php'),
      array('http://example.com/foo bar/', '/index.php',               'http://example.com/index.php'),
      array('http://example.com/foo bar/', './index.php',              'http://example.com/foo bar/index.php'),
      array('http://example.com/foo bar/', '../index.php',             'http://example.com/index.php'),
      array('http://example.com/foo bar/', '../../index.php',          'http://example.com/index.php'),
      array('http://example.com/foo?a=b',  '?c=d',                     'http://example.com/foo?c=d'),
      array('http://example.com/foo?a=b',  'index.php',                'http://example.com/index.php'),
      array('http://example.com/foo?a=b',  '/index.php',               'http://example.com/index.php'),
      array('http://example.com/foo?a=b',  './index.php',              'http://example.com/index.php'),
      array('http://example.com/foo?a=b',  '../index.php',             'http://example.com/index.php'),
      array('http://example.com/foo?a=b',  '../../index.php',          'http://example.com/index.php'),
      array('http://example.com/foo?a=b',  'bar/index.php',            'http://example.com/bar/index.php'),
      array('http://example.com/foo?a=b',  '/bar/index.php',           'http://example.com/bar/index.php'),
      array('http://example.com/foo?a=b',  '/bar/index.php?a=b',       'http://example.com/bar/index.php?a=b'),
      array('http://example.com/foo?a=b',  '//test.ru/index.php',      'http://test.ru/index.php'),
      array('http://example.com/foo?a=b',  'http://test.ru/index.php', 'http://test.ru/index.php'),
      array('http://example.com/foo?a=b/', '?c=d',                     'http://example.com/foo?c=d'),
      array('http://example.com/foo?a=b/', 'index.php',                'http://example.com/index.php'),
      array('http://example.com/foo?a=b/', '/index.php',               'http://example.com/index.php'),
      array('http://example.com/foo?a=b/', './index.php',              'http://example.com/index.php'),
      array('http://example.com/foo?a=b/', '../index.php',             'http://example.com/index.php'),
      array('http://example.com/foo?a=b/', '../../index.php',          'http://example.com/index.php'),
      array('http://example.com/foo?a=b/', 'bar/index.php',            'http://example.com/bar/index.php'),
      array('http://example.com/foo?a=b/', '/bar/index.php',           'http://example.com/bar/index.php'),
      array('http://example.com/foo?a=b/', '/bar/index.php?a=b',       'http://example.com/bar/index.php?a=b'),
      array('http://example.com/foo?a=b/', '//test.ru/index.php',      'http://test.ru/index.php'),
      array('http://example.com/foo?a=b/', 'http://test.ru/index.php', 'http://test.ru/index.php'),
      array('http://example.com/',         'http://test.ru/index.php', 'http://test.ru/index.php'),
    );
    
    foreach ($test_data as $urls) {
      $this->assertEqual(
        parser_get_absolute_url($urls[0], $urls[1]),
        $urls[2],
        '"' . $urls[0] . '" + "' . $urls[1] . '" = "' . $urls[2] . '"'
      );
    }
  }
}
